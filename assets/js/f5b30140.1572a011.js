"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[239],{8453(e,s,n){n.d(s,{R:()=>c,x:()=>i});var r=n(6540);const o={},a=r.createContext(o);function c(e){const s=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),r.createElement(a.Provider,{value:s},e.children)}},8693(e,s,n){n.r(s),n.d(s,{assets:()=>t,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"appendix/operations/postgres","title":"PostgreSQL Backup and Restore Guide","description":"This guide provides comprehensive instructions for backing up and restoring PostgreSQL databases in Docker containers.","source":"@site/docs/appendix/operations/postgres.md","sourceDirName":"appendix/operations","slug":"/appendix/operations/postgres","permalink":"/OpenGIN/docs/appendix/operations/postgres","draft":false,"unlisted":false,"editUrl":"https://github.com/LDFLK/OpenGIN/tree/main/docs/docs/appendix/operations/postgres.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Neo4j Backup","permalink":"/OpenGIN/docs/appendix/operations/neo4j"},"next":{"title":"FAQ","permalink":"/OpenGIN/docs/faq"}}');var o=n(4848),a=n(8453);const c={},i="PostgreSQL Backup and Restore Guide",t={},l=[{value:"Data Backups Repository Structure",id:"data-backups-repository-structure",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Backup and Restore Commands",id:"backup-and-restore-commands",level:2},{value:"Method 1: Direct Docker Commands (Recommended)",id:"method-1-direct-docker-commands-recommended",level:3},{value:"1.1 Create PostgreSQL Backup",id:"11-create-postgresql-backup",level:4},{value:"1.2 Restore PostgreSQL from Backup",id:"12-restore-postgresql-from-backup",level:4},{value:"Method 2: Using Docker Volume Mounts",id:"method-2-using-docker-volume-mounts",level:3},{value:"2.1 Create Backup with Volume Mount",id:"21-create-backup-with-volume-mount",level:4},{value:"2.2 Restore with Volume Mount",id:"22-restore-with-volume-mount",level:4},{value:"Configuration",id:"configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Docker Compose Volumes",id:"docker-compose-volumes",level:3},{value:"Backup Strategies",id:"backup-strategies",level:2},{value:"1. Full Database Backup",id:"1-full-database-backup",level:3},{value:"2. Specific Schema Backup",id:"2-specific-schema-backup",level:3},{value:"3. Compressed Backup",id:"3-compressed-backup",level:3},{value:"4. Custom Format Backup",id:"4-custom-format-backup",level:3},{value:"Restore Strategies",id:"restore-strategies",level:2},{value:"1. Full Database Restore",id:"1-full-database-restore",level:3},{value:"2. Custom Format Restore",id:"2-custom-format-restore",level:3},{value:"3. Schema-only Restore",id:"3-schema-only-restore",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"1. Connection Refused",id:"1-connection-refused",level:4},{value:"2. Permission Denied",id:"2-permission-denied",level:4},{value:"3. Database Not Found",id:"3-database-not-found",level:4},{value:"4. Backup File Not Found",id:"4-backup-file-not-found",level:4},{value:"Advanced Troubleshooting",id:"advanced-troubleshooting",level:3},{value:"1. Check PostgreSQL Version",id:"1-check-postgresql-version",level:4},{value:"2. Check Database Size",id:"2-check-database-size",level:4},{value:"3. Check Active Connections",id:"3-check-active-connections",level:4},{value:"Restoring in Neon",id:"restoring-in-neon",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Regular Backups",id:"1-regular-backups",level:3},{value:"2. Backup Storage",id:"2-backup-storage",level:3},{value:"3. Monitoring",id:"3-monitoring",level:3},{value:"4. Security",id:"4-security",level:3}];function d(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"postgresql-backup-and-restore-guide",children:"PostgreSQL Backup and Restore Guide"})}),"\n",(0,o.jsx)(s.p,{children:"This guide provides comprehensive instructions for backing up and restoring PostgreSQL databases in Docker containers."}),"\n",(0,o.jsx)(s.h2,{id:"data-backups-repository-structure",children:"Data Backups Repository Structure"}),"\n",(0,o.jsx)(s.p,{children:"Backups are stored in a structured repository following this hierarchy:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"data-backups/\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 opengin\n    \u251c\u2500\u2500 development\n    \u2502   \u251c\u2500\u2500 mongodb\n    \u2502   \u2502   \u2514\u2500\u2500 opengin.tar.gz\n    \u2502   \u251c\u2500\u2500 neo4j\n    \u2502   \u2502   \u2514\u2500\u2500 neo4j.dump\n    \u2502   \u2514\u2500\u2500 postgres\n    \u2502       \u2514\u2500\u2500 opengin.tar.gz\n    \u251c\u2500\u2500 production\n    \u2502   \u251c\u2500\u2500 mongodb\n    \u2502   \u2514\u2500\u2500 neo4j\n    \u2514\u2500\u2500 staging\n        \u251c\u2500\u2500 mongodb\n        \u2514\u2500\u2500 neo4j\n"})}),"\n",(0,o.jsx)(s.p,{children:"This structure allows for:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Environment separation"}),": development, staging, production"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Database type organization"}),": mongodb, neo4j, postgres"]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Version management"}),": 0.0.1, 0.0.2, etc."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.strong,{children:"Consistent naming"}),": All backups follow the same pattern"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Docker installed and running"}),"\n",(0,o.jsx)(s.li,{children:"PostgreSQL container running (using docker-compose)"}),"\n",(0,o.jsx)(s.li,{children:"Access to PostgreSQL container"}),"\n",(0,o.jsxs)(s.li,{children:["PostgreSQL credentials (replace ",(0,o.jsx)(s.code,{children:"<your_username>"})," and ",(0,o.jsx)(s.code,{children:"<your_password>"})," in commands below)"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"backup-and-restore-commands",children:"Backup and Restore Commands"}),"\n",(0,o.jsx)(s.h3,{id:"method-1-direct-docker-commands-recommended",children:"Method 1: Direct Docker Commands (Recommended)"}),"\n",(0,o.jsx)(s.h4,{id:"11-create-postgresql-backup",children:"1.1 Create PostgreSQL Backup"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Create backup directory\nmkdir -p ./backups/postgres\n\n# Create PostgreSQL dump\ndocker exec postgres pg_dump -U <your_username> -h localhost -d <your_database> -f /var/lib/postgresql/backup/opengin.sql\n\n# Copy backup from container to host\ndocker cp postgres:/var/lib/postgresql/backup/opengin.sql ./backups/postgres/\n\n# Create compressed archive\ncd ./backups/postgres\ntar -czf opengin.tar.gz opengin.sql\nrm -rf opengin.sql\n\n# Clean up container backup\ndocker exec postgres rm -rf /var/lib/postgresql/backup/opengin.sql\n"})}),"\n",(0,o.jsx)(s.h4,{id:"12-restore-postgresql-from-backup",children:"1.2 Restore PostgreSQL from Backup"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Extract backup file\ntar -xzf opengin.tar.gz\n\n# Copy backup to container\ndocker cp opengin.sql postgres:/var/lib/postgresql/backup/\n\n# Restore database\ndocker exec postgres psql -U <your_username> -d <your_database> -f /var/lib/postgresql/backup/opengin.sql\n\n# Clean up\ndocker exec postgres rm -rf /var/lib/postgresql/backup/opengin.sql\nrm -rf opengin.sql\n"})}),"\n",(0,o.jsx)(s.h3,{id:"method-2-using-docker-volume-mounts",children:"Method 2: Using Docker Volume Mounts"}),"\n",(0,o.jsx)(s.h4,{id:"21-create-backup-with-volume-mount",children:"2.1 Create Backup with Volume Mount"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Create backup directory\nmkdir -p ./backups/postgres\n\n# Run pg_dump with volume mount\ndocker run --rm \\\n    --network=ldf-network \\\n    --volume=postgres_data:/var/lib/postgresql/data \\\n    --volume=$(pwd)/backups/postgres:/backups \\\n    postgres:16 \\\n    pg_dump -U <your_username> -h postgres -d <your_database> -f /backups/opengin.sql\n\n# Create compressed archive\ncd ./backups/postgres\ntar -czf opengin.tar.gz opengin.sql\nrm -rf opengin.sql\n"})}),"\n",(0,o.jsx)(s.h4,{id:"22-restore-with-volume-mount",children:"2.2 Restore with Volume Mount"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Extract backup file\ntar -xzf opengin.tar.gz\n\n# Run psql with volume mount\ndocker run --rm \\\n    --network=ldf-network \\\n    --volume=postgres_data:/var/lib/postgresql/data \\\n    --volume=$(pwd)/backups/postgres:/backups \\\n    postgres:16 \\\n    psql -U <your_username> -h postgres -d <your_database> -f /backups/opengin.sql\n\n# Clean up\nrm -rf opengin.sql\n"})}),"\n",(0,o.jsx)(s.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsx)(s.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,o.jsxs)(s.p,{children:["The backup process uses the following environment variables from ",(0,o.jsx)(s.code,{children:"configs/backup.env"}),":"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# PostgreSQL Backup Configuration\nPOSTGRES_BACKUP_DIR=/path/to/backup/directory\nPOSTGRES_USER=postgres\nPOSTGRES_PASSWORD=postgres\nPOSTGRES_DATABASE=opengin\n"})}),"\n",(0,o.jsx)(s.h3,{id:"docker-compose-volumes",children:"Docker Compose Volumes"}),"\n",(0,o.jsx)(s.p,{children:"The PostgreSQL service uses the following volumes:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-yaml",children:"volumes:\n  - postgres_data:/var/lib/postgresql/data    # Database data\n  - postgres_backup:/var/lib/postgresql/backup # Backup storage\n"})}),"\n",(0,o.jsx)(s.h2,{id:"backup-strategies",children:"Backup Strategies"}),"\n",(0,o.jsx)(s.h3,{id:"1-full-database-backup",children:"1. Full Database Backup"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Backup entire database\ndocker exec postgres pg_dump -U <your_username> -h localhost -d <your_database> -f /var/lib/postgresql/backup/opengin.sql\n"})}),"\n",(0,o.jsx)(s.h3,{id:"2-specific-schema-backup",children:"2. Specific Schema Backup"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Backup specific schema\ndocker exec postgres pg_dump -U <your_username> -h localhost -d <your_database> -n <schema_name> -f /var/lib/postgresql/backup/schema_backup.sql\n"})}),"\n",(0,o.jsx)(s.h3,{id:"3-compressed-backup",children:"3. Compressed Backup"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Create compressed backup\ndocker exec postgres pg_dump -U <your_username> -h localhost -d <your_database> -Z 9 -f /var/lib/postgresql/backup/opengin.sql.gz\n"})}),"\n",(0,o.jsx)(s.h3,{id:"4-custom-format-backup",children:"4. Custom Format Backup"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Create custom format backup (binary format)\ndocker exec postgres pg_dump -U <your_username> -h localhost -d <your_database> -Fc -f /var/lib/postgresql/backup/opengin.dump\n"})}),"\n",(0,o.jsx)(s.h2,{id:"restore-strategies",children:"Restore Strategies"}),"\n",(0,o.jsx)(s.h3,{id:"1-full-database-restore",children:"1. Full Database Restore"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Restore entire database\ndocker exec postgres psql -U <your_username> -d <your_database> -f /var/lib/postgresql/backup/opengin.sql\n"})}),"\n",(0,o.jsx)(s.h3,{id:"2-custom-format-restore",children:"2. Custom Format Restore"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Restore from custom format backup\ndocker exec postgres pg_restore -U <your_username> -h localhost -d <your_database> /var/lib/postgresql/backup/opengin.dump\n"})}),"\n",(0,o.jsx)(s.h3,{id:"3-schema-only-restore",children:"3. Schema-only Restore"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Restore schema only (no data)\ndocker exec postgres psql -U <your_username> -d <your_database> -f /var/lib/postgresql/backup/schema_backup.sql\n"})}),"\n",(0,o.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(s.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,o.jsx)(s.h4,{id:"1-connection-refused",children:"1. Connection Refused"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Check if PostgreSQL container is running\ndocker ps | grep postgres\n\n# Check container logs\ndocker logs postgres\n\n# Test connection\ndocker exec postgres pg_isready -U postgres\n"})}),"\n",(0,o.jsx)(s.h4,{id:"2-permission-denied",children:"2. Permission Denied"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Check file permissions in container\ndocker exec postgres ls -la /var/lib/postgresql/backup/\n\n# Fix permissions if needed\ndocker exec postgres chown postgres:postgres /var/lib/postgresql/backup/\n"})}),"\n",(0,o.jsx)(s.h4,{id:"3-database-not-found",children:"3. Database Not Found"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:'# List available databases\ndocker exec postgres psql -U postgres -c "\\l"\n\n# Create database if needed\ndocker exec postgres createdb -U postgres <database_name>\n'})}),"\n",(0,o.jsx)(s.h4,{id:"4-backup-file-not-found",children:"4. Backup File Not Found"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"# Check if backup directory exists\ndocker exec postgres ls -la /var/lib/postgresql/\n\n# Create backup directory\ndocker exec postgres mkdir -p /var/lib/postgresql/backup\n"})}),"\n",(0,o.jsx)(s.h3,{id:"advanced-troubleshooting",children:"Advanced Troubleshooting"}),"\n",(0,o.jsx)(s.h4,{id:"1-check-postgresql-version",children:"1. Check PostgreSQL Version"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:'docker exec postgres psql -U postgres -c "SELECT version();"\n'})}),"\n",(0,o.jsx)(s.h4,{id:"2-check-database-size",children:"2. Check Database Size"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"docker exec postgres psql -U postgres -c \"SELECT pg_size_pretty(pg_database_size('<database_name>'));\"\n"})}),"\n",(0,o.jsx)(s.h4,{id:"3-check-active-connections",children:"3. Check Active Connections"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:'docker exec postgres psql -U postgres -c "SELECT * FROM pg_stat_activity;"\n'})}),"\n",(0,o.jsx)(s.h2,{id:"restoring-in-neon",children:"Restoring in Neon"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:'psql "<connection-string-from-neon>" -f <path-to-backup-folder>/opengin.sql\n'})}),"\n",(0,o.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsx)(s.h3,{id:"1-regular-backups",children:"1. Regular Backups"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Schedule automated backups using cron jobs"}),"\n",(0,o.jsx)(s.li,{children:"Keep multiple backup versions"}),"\n",(0,o.jsx)(s.li,{children:"Test restore procedures regularly"}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"2-backup-storage",children:"2. Backup Storage"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Store backups in multiple locations"}),"\n",(0,o.jsx)(s.li,{children:"Use compression to save space"}),"\n",(0,o.jsx)(s.li,{children:"Encrypt sensitive backup data"}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"3-monitoring",children:"3. Monitoring"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Monitor backup success/failure"}),"\n",(0,o.jsx)(s.li,{children:"Set up alerts for backup failures"}),"\n",(0,o.jsx)(s.li,{children:"Log backup activities"}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"4-security",children:"4. Security"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Use strong passwords"}),"\n",(0,o.jsx)(s.li,{children:"Limit backup file permissions"}),"\n",(0,o.jsx)(s.li,{children:"Secure backup storage locations"}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);