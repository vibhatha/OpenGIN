"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[876],{8453(e,n,o){o.d(n,{R:()=>c,x:()=>i});var a=o(6540);const s={},r=a.createContext(s);function c(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),a.createElement(r.Provider,{value:n},e.children)}},8537(e,n,o){o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>a,toc:()=>t});const a=JSON.parse('{"id":"appendix/operations/mongodb","title":"MongoDB Backup and Restore Guide","description":"This guide provides comprehensive instructions for backing up and restoring MongoDB databases in Docker containers.","source":"@site/docs/appendix/operations/mongodb.md","sourceDirName":"appendix/operations","slug":"/appendix/operations/mongodb","permalink":"/OpenGIN/docs/appendix/operations/mongodb","draft":false,"unlisted":false,"editUrl":"https://github.com/LDFLK/OpenGIN/tree/main/docs/docs/appendix/operations/mongodb.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Backup Integration","permalink":"/OpenGIN/docs/appendix/operations/backup_integration"},"next":{"title":"Neo4j Backup","permalink":"/OpenGIN/docs/appendix/operations/neo4j"}}');var s=o(4848),r=o(8453);const c={},i="MongoDB Backup and Restore Guide",d={},t=[{value:"Data Backups Repository Structure",id:"data-backups-repository-structure",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Backup and Restore Commands",id:"backup-and-restore-commands",level:2},{value:"Method 1: Direct Docker Commands (Recommended)",id:"method-1-direct-docker-commands-recommended",level:3},{value:"1.1 Create MongoDB Backup",id:"11-create-mongodb-backup",level:4},{value:"1.2 Restore MongoDB from Backup",id:"12-restore-mongodb-from-backup",level:4},{value:"Method 2: Using Docker Volume Mounts",id:"method-2-using-docker-volume-mounts",level:3},{value:"2.1 Create Backup with Volume Mount",id:"21-create-backup-with-volume-mount",level:4},{value:"2.2 Restore with Volume Mount",id:"22-restore-with-volume-mount",level:4},{value:"Configuration",id:"configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Docker Compose Volumes",id:"docker-compose-volumes",level:3},{value:"Backup Strategies",id:"backup-strategies",level:2},{value:"1. Full Database Backup",id:"1-full-database-backup",level:3},{value:"2. Specific Collection Backup",id:"2-specific-collection-backup",level:3},{value:"3. Compressed Backup",id:"3-compressed-backup",level:3},{value:"Restore Strategies",id:"restore-strategies",level:2},{value:"1. Full Database Restore",id:"1-full-database-restore",level:3},{value:"2. Specific Collection Restore",id:"2-specific-collection-restore",level:3},{value:"3. Compressed Restore",id:"3-compressed-restore",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"1. Permission Denied",id:"1-permission-denied",level:4},{value:"2. Authentication Failed",id:"2-authentication-failed",level:4},{value:"3. Backup Directory Not Found",id:"3-backup-directory-not-found",level:4},{value:"Verification Commands",id:"verification-commands",level:3},{value:"Check Backup Integrity",id:"check-backup-integrity",level:4},{value:"Check Restore Success",id:"check-restore-success",level:4},{value:"Restore to Mongodb Atlas",id:"restore-to-mongodb-atlas",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Regular Backups",id:"1-regular-backups",level:3},{value:"2. Backup Storage",id:"2-backup-storage",level:3},{value:"3. Monitoring",id:"3-monitoring",level:3},{value:"4. Security",id:"4-security",level:3},{value:"Backup Script Example",id:"backup-script-example",level:3},{value:"Support",id:"support",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"mongodb-backup-and-restore-guide",children:"MongoDB Backup and Restore Guide"})}),"\n",(0,s.jsx)(n.p,{children:"This guide provides comprehensive instructions for backing up and restoring MongoDB databases in Docker containers."}),"\n",(0,s.jsx)(n.h2,{id:"data-backups-repository-structure",children:"Data Backups Repository Structure"}),"\n",(0,s.jsx)(n.p,{children:"Backups are stored in a structured repository following this hierarchy:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"data-backups/\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 opengin\n    \u251c\u2500\u2500 development\n    \u2502   \u251c\u2500\u2500 mongodb\n    \u2502   \u2502   \u2514\u2500\u2500 opengin.tar.gz\n    \u2502   \u251c\u2500\u2500 neo4j\n    \u2502   \u2502   \u2514\u2500\u2500 neo4j.dump\n    \u2502   \u2514\u2500\u2500 postgres\n    \u2502       \u2514\u2500\u2500 opengin.tar.gz\n    \u251c\u2500\u2500 production\n    \u2502   \u251c\u2500\u2500 mongodb\n    \u2502   \u2514\u2500\u2500 neo4j\n    \u2514\u2500\u2500 staging\n        \u251c\u2500\u2500 mongodb\n        \u2514\u2500\u2500 neo4j\n"})}),"\n",(0,s.jsx)(n.p,{children:"This structure allows for:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Environment separation"}),": development, staging, production"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database type organization"}),": mongodb, neo4j, postgres"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Version management"}),": 0.0.1, 0.0.2, etc."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consistent naming"}),": All backups follow the same pattern"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Docker installed and running"}),"\n",(0,s.jsx)(n.li,{children:"MongoDB container running (using docker-compose)"}),"\n",(0,s.jsx)(n.li,{children:"Access to MongoDB container"}),"\n",(0,s.jsxs)(n.li,{children:["MongoDB credentials (replace ",(0,s.jsx)(n.code,{children:"<your_username>"})," and ",(0,s.jsx)(n.code,{children:"<your_password>"})," in commands below)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"backup-and-restore-commands",children:"Backup and Restore Commands"}),"\n",(0,s.jsx)(n.h3,{id:"method-1-direct-docker-commands-recommended",children:"Method 1: Direct Docker Commands (Recommended)"}),"\n",(0,s.jsx)(n.h4,{id:"11-create-mongodb-backup",children:"1.1 Create MongoDB Backup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Create backup directory\nmkdir -p ./backups/mongodb\n\n# Create MongoDB dump\ndocker exec mongodb mongodump \\\n    --host=localhost:27017 \\\n    --username=<your_username> \\\n    --password=<your_password> \\\n    --authenticationDatabase=admin \\\n    --db=opengin \\\n    --out=/data/backup/mongodb_backup_$(date +%Y%m%d_%H%M%S)\n\n# Copy backup from container to host\ndocker cp mongodb:/data/backup/mongodb_backup_$(date +%Y%m%d_%H%M%S) ./backups/mongodb/\n\n# Create compressed archive\ncd ./backups/mongodb\ntar -czf mongodb_backup_$(date +%Y%m%d_%H%M%S).tar.gz mongodb_backup_*\nrm -rf mongodb_backup_*\n\n# Clean up container backup\ndocker exec mongodb rm -rf /data/backup/mongodb_backup_*\n"})}),"\n",(0,s.jsx)(n.h4,{id:"12-restore-mongodb-from-backup",children:"1.2 Restore MongoDB from Backup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Extract backup file\ntar -xzf mongodb_backup_20241215_143022.tar.gz\n\n# Copy backup to container\ndocker cp mongodb_backup_20241215_143022 mongodb:/data/backup/\n\n# Restore database\ndocker exec mongodb mongorestore \\\n    --host=localhost:27017 \\\n    --username=<your_username> \\\n    --password=<your_password> \\\n    --authenticationDatabase=admin \\\n    --db=opengin \\\n    --drop \\\n    /data/backup/mongodb_backup_20241215_143022/opengin\n\n# Clean up\ndocker exec mongodb rm -rf /data/backup/mongodb_backup_20241215_143022\nrm -rf mongodb_backup_20241215_143022\n"})}),"\n",(0,s.jsx)(n.h3,{id:"method-2-using-docker-volume-mounts",children:"Method 2: Using Docker Volume Mounts"}),"\n",(0,s.jsx)(n.h4,{id:"21-create-backup-with-volume-mount",children:"2.1 Create Backup with Volume Mount"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Create backup directory\nmkdir -p ./backups/mongodb\n\n# Run mongodump with volume mount\ndocker run --rm \\\n    --network=ldf-network \\\n    --volume=mongodb_data:/data/db \\\n    --volume=$(pwd)/backups/mongodb:/backups \\\n    mongo:4.4 \\\n    mongodump \\\n    --host=mongodb:27017 \\\n    --username=<your_username> \\\n    --password=<your_password> \\\n    --authenticationDatabase=admin \\\n    --db=opengin \\\n    --out=/backups/mongodb_backup_$(date +%Y%m%d_%H%M%S)\n\n# Create compressed archive\ncd ./backups/mongodb\ntar -czf mongodb_backup_$(date +%Y%m%d_%H%M%S).tar.gz mongodb_backup_*\nrm -rf mongodb_backup_*\n"})}),"\n",(0,s.jsx)(n.h4,{id:"22-restore-with-volume-mount",children:"2.2 Restore with Volume Mount"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Extract backup file\ntar -xzf mongodb_backup_20241215_143022.tar.gz\n\n# Run mongorestore with volume mount\ndocker run --rm \\\n    --network=ldf-network \\\n    --volume=mongodb_data:/data/db \\\n    --volume=$(pwd)/backups/mongodb:/backups \\\n    mongo:4.4 \\\n    mongorestore \\\n    --host=mongodb:27017 \\\n    --username=<your_username> \\\n    --password=<your_password> \\\n    --authenticationDatabase=admin \\\n    --db=opengin \\\n    --drop \\\n    /backups/mongodb_backup_20241215_143022/opengin\n\n# Clean up\nrm -rf mongodb_backup_20241215_143022\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsxs)(n.p,{children:["Configure your backup settings in ",(0,s.jsx)(n.code,{children:"configs/backup.env"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# MongoDB Backup Configuration\nMONGODB_BACKUP_DIR=/path/to/your/backups/mongodb\n\n# MongoDB Credentials\nMONGO_USER=admin\nMONGO_PASSWORD=admin123\nMONGO_DATABASE=opengin\n"})}),"\n",(0,s.jsx)(n.h3,{id:"docker-compose-volumes",children:"Docker Compose Volumes"}),"\n",(0,s.jsx)(n.p,{children:"The MongoDB service uses the following volumes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"volumes:\n  - mongodb_data:/data/db          # Database data\n  - mongodb_config:/data/configdb  # Configuration\n  - mongodb_backup:/data/backup    # Backup storage\n"})}),"\n",(0,s.jsx)(n.h2,{id:"backup-strategies",children:"Backup Strategies"}),"\n",(0,s.jsx)(n.h3,{id:"1-full-database-backup",children:"1. Full Database Backup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Backup entire database\ndocker exec mongodb mongodump \\\n    --host=localhost:27017 \\\n    --username=<your_username> \\\n    --password=<your_password> \\\n    --authenticationDatabase=admin \\\n    --db=opengin \\\n    --out=/data/backup/mongodb_backup_$(date +%Y%m%d_%H%M%S)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-specific-collection-backup",children:"2. Specific Collection Backup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Backup specific collection\ndocker exec mongodb mongodump \\\n    --host=localhost:27017 \\\n    --username=<your_username> \\\n    --password=<your_password> \\\n    --authenticationDatabase=admin \\\n    --db=opengin \\\n    --collection=your_collection \\\n    --out=/data/backup/collection_backup\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-compressed-backup",children:"3. Compressed Backup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Create compressed backup\ndocker exec mongodb mongodump \\\n    --host=localhost:27017 \\\n    --username=<your_username> \\\n    --password=<your_password> \\\n    --authenticationDatabase=admin \\\n    --db=opengin \\\n    --archive=/data/backup/mongodb_backup.gz \\\n    --gzip\n"})}),"\n",(0,s.jsx)(n.h2,{id:"restore-strategies",children:"Restore Strategies"}),"\n",(0,s.jsx)(n.h3,{id:"1-full-database-restore",children:"1. Full Database Restore"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Restore entire database\ndocker exec mongodb mongorestore \\\n    --host=localhost:27017 \\\n    --username=<your_username> \\\n    --password=<your_password> \\\n    --authenticationDatabase=admin \\\n    --db=opengin \\\n    --drop \\\n    /data/backup/mongodb_backup_20241215_143022/opengin\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-specific-collection-restore",children:"2. Specific Collection Restore"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Restore specific collection\ndocker exec mongodb mongorestore \\\n    --host=localhost:27017 \\\n    --username=<your_username> \\\n    --password=<your_password> \\\n    --authenticationDatabase=admin \\\n    --db=opengin \\\n    --collection=your_collection \\\n    /data/backup/collection_backup/opengin/your_collection.bson\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-compressed-restore",children:"3. Compressed Restore"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Restore from compressed backup\ndocker exec mongodb mongorestore \\\n    --host=localhost:27017 \\\n    --username=<your_username> \\\n    --password=<your_password> \\\n    --authenticationDatabase=admin \\\n    --db=opengin \\\n    --archive=/data/backup/mongodb_backup.gz \\\n    --gzip\n"})}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,s.jsx)(n.h4,{id:"1-permission-denied",children:"1. Permission Denied"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check container permissions\ndocker exec mongodb ls -la /data/backup\n\n# Fix permissions if needed\ndocker exec mongodb chown -R mongodb:mongodb /data/backup\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-authentication-failed",children:"2. Authentication Failed"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Verify MongoDB is running\ndocker exec mongodb mongo --eval \"db.adminCommand('ping')\"\n\n# Check credentials\ndocker exec mongodb mongo -u admin -p admin123 --authenticationDatabase=admin\n"})}),"\n",(0,s.jsx)(n.h4,{id:"3-backup-directory-not-found",children:"3. Backup Directory Not Found"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Create backup directory\ndocker exec mongodb mkdir -p /data/backup\n\n# Set proper permissions\ndocker exec mongodb chown -R mongodb:mongodb /data/backup\n"})}),"\n",(0,s.jsx)(n.h3,{id:"verification-commands",children:"Verification Commands"}),"\n",(0,s.jsx)(n.h4,{id:"check-backup-integrity",children:"Check Backup Integrity"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# List backup contents\ntar -tzf mongodb_backup_20241215_143022.tar.gz\n\n# Verify database structure\ndocker exec mongodb mongo --eval \"db.adminCommand('listCollections')\"\n"})}),"\n",(0,s.jsx)(n.h4,{id:"check-restore-success",children:"Check Restore Success"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Verify data was restored\ndocker exec mongodb mongo --eval "db.stats()"\n\n# Check specific collections\ndocker exec mongodb mongo --eval "db.your_collection.count()"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"restore-to-mongodb-atlas",children:"Restore to Mongodb Atlas"}),"\n",(0,s.jsx)(n.p,{children:"Note that this dump must be taken from OpenGIN dump program."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'mongorestore --uri="<mongodb-service-uri>" --db=opengin --drop "<path-to-the-dump-folder>"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"1-regular-backups",children:"1. Regular Backups"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Schedule daily backups using cron"}),"\n",(0,s.jsx)(n.li,{children:"Keep multiple backup versions"}),"\n",(0,s.jsx)(n.li,{children:"Test restore procedures regularly"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-backup-storage",children:"2. Backup Storage"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Store backups in multiple locations"}),"\n",(0,s.jsx)(n.li,{children:"Use compression to save space"}),"\n",(0,s.jsx)(n.li,{children:"Encrypt sensitive backup data"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-monitoring",children:"3. Monitoring"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Monitor backup success/failure"}),"\n",(0,s.jsx)(n.li,{children:"Set up alerts for backup failures"}),"\n",(0,s.jsx)(n.li,{children:"Log backup activities"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"4-security",children:"4. Security"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use strong authentication credentials"}),"\n",(0,s.jsx)(n.li,{children:"Limit backup access permissions"}),"\n",(0,s.jsx)(n.li,{children:"Encrypt backup files"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"backup-script-example",children:"Backup Script Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# Daily MongoDB backup script\n\nBACKUP_DIR="/path/to/backups/mongodb"\nLOG_FILE="/var/log/mongodb_backup.log"\n\n# Create backup\n/path/to/deployment/development/init.sh backup_mongodb >> $LOG_FILE 2>&1\n\n# Clean up old backups (keep last 7 days)\nfind $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete\n\n# Send notification\necho "MongoDB backup completed on $(date)" | mail -s "MongoDB Backup" admin@example.com\n'})}),"\n",(0,s.jsx)(n.h2,{id:"support",children:"Support"}),"\n",(0,s.jsx)(n.p,{children:"For issues or questions regarding MongoDB backup and restore:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Check the troubleshooting section above"}),"\n",(0,s.jsx)(n.li,{children:"Review MongoDB documentation"}),"\n",(0,s.jsxs)(n.li,{children:["Check container logs: ",(0,s.jsx)(n.code,{children:"docker logs mongodb"})]}),"\n",(0,s.jsxs)(n.li,{children:["Verify network connectivity: ",(0,s.jsx)(n.code,{children:"docker network ls"})]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);