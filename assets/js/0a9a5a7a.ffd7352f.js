"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[86],{7757(e,n,o){o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"appendix/operations/neo4j","title":"Neo4j Migration Guide: Docker Container to Aura","description":"This guide provides step-by-step instructions for migrating a Neo4j database from a Docker container to Neo4j Aura.","source":"@site/docs/appendix/operations/neo4j.md","sourceDirName":"appendix/operations","slug":"/appendix/operations/neo4j","permalink":"/OpenGIN/docs/appendix/operations/neo4j","draft":false,"unlisted":false,"editUrl":"https://github.com/LDFLK/OpenGIN/tree/main/docs/docs/appendix/operations/neo4j.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"MongoDB Backup","permalink":"/OpenGIN/docs/appendix/operations/mongodb"},"next":{"title":"PostgreSQL Backup","permalink":"/OpenGIN/docs/appendix/operations/postgres"}}');var a=o(4848),r=o(8453);const i={},s="Neo4j Migration Guide: Docker Container to Aura",d={},c=[{value:"Data Backups Repository Structure",id:"data-backups-repository-structure",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Migration Steps",id:"migration-steps",level:2},{value:"1. Stop the Neo4j Container",id:"1-stop-the-neo4j-container",level:3},{value:"2. Identify where the data is stored in the container",id:"2-identify-where-the-data-is-stored-in-the-container",level:3},{value:"3. Create a Local Dump Folder",id:"3-create-a-local-dump-folder",level:3},{value:"4. Create a Database Dump",id:"4-create-a-database-dump",level:3},{value:"4. Verify the Database Dump was created",id:"4-verify-the-database-dump-was-created",level:3},{value:"5. Upload the Dump to the Neo4j Docker (Local)",id:"5-upload-the-dump-to-the-neo4j-docker-local",level:3},{value:"6. Upload the Dump to Neo4j Aura",id:"6-upload-the-dump-to-neo4j-aura",level:3},{value:"5. Verify the Migration",id:"5-verify-the-migration",level:3}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"neo4j-migration-guide-docker-container-to-aura",children:"Neo4j Migration Guide: Docker Container to Aura"})}),"\n",(0,a.jsx)(n.p,{children:"This guide provides step-by-step instructions for migrating a Neo4j database from a Docker container to Neo4j Aura."}),"\n",(0,a.jsx)(n.h2,{id:"data-backups-repository-structure",children:"Data Backups Repository Structure"}),"\n",(0,a.jsx)(n.p,{children:"Backups are stored in a structured repository following this hierarchy:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"data-backups/\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 opengin\n    \u251c\u2500\u2500 development\n    \u2502   \u251c\u2500\u2500 mongodb\n    \u2502   \u2502   \u2514\u2500\u2500 opengin.tar.gz\n    \u2502   \u251c\u2500\u2500 neo4j\n    \u2502   \u2502   \u2514\u2500\u2500 neo4j.dump\n    \u2502   \u2514\u2500\u2500 postgres\n    \u2502       \u2514\u2500\u2500 opengin.tar.gz\n    \u251c\u2500\u2500 production\n    \u2502   \u251c\u2500\u2500 mongodb\n    \u2502   \u2514\u2500\u2500 neo4j\n    \u2514\u2500\u2500 staging\n        \u251c\u2500\u2500 mongodb\n        \u2514\u2500\u2500 neo4j\n"})}),"\n",(0,a.jsx)(n.p,{children:"This structure allows for:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Environment separation"}),": development, staging, production"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Database type organization"}),": mongodb, neo4j, postgres"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Version management"}),": 0.0.1, 0.0.2, etc."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Consistent naming"}),": All backups follow the same pattern"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Docker installed and running"}),"\n",(0,a.jsx)(n.li,{children:"Access to your Neo4j Docker container"}),"\n",(0,a.jsx)(n.li,{children:"Neo4j Aura account and database instance"}),"\n",(0,a.jsx)(n.li,{children:"Neo4j Aura connection URI, username, and password"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"migration-steps",children:"Migration Steps"}),"\n",(0,a.jsx)(n.h3,{id:"1-stop-the-neo4j-container",children:"1. Stop the Neo4j Container"}),"\n",(0,a.jsx)(n.p,{children:"Make sure the neo4j container is stopped before creating the dump."}),"\n",(0,a.jsx)(n.h3,{id:"2-identify-where-the-data-is-stored-in-the-container",children:"2. Identify where the data is stored in the container"}),"\n",(0,a.jsx)(n.p,{children:"Find the directory path that's mapped to /data in your neo4j container, this is where the data is stored."}),"\n",(0,a.jsxs)(n.p,{children:["Run ",(0,a.jsx)(n.code,{children:"docker inspect <container_name>"})," and look for the ",(0,a.jsx)(n.code,{children:"Source"})," path in the Mounts section."]}),"\n",(0,a.jsx)(n.p,{children:"This will look something like the following:"}),"\n",(0,a.jsxs)(n.p,{children:["If you are using an standalone Docker container built on top of an exisitng neo4j image with volumes named\n",(0,a.jsx)(n.code,{children:"/var/lib/docker/volumes/neo4j_data/_data"})]}),"\n",(0,a.jsxs)(n.p,{children:["Or if you are using the ",(0,a.jsx)(n.code,{children:"docker-compose.yml"})," to build you will see the volume as ",(0,a.jsx)(n.code,{children:"ldfarchitecture_neo4j_data"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Set this as ",(0,a.jsx)(n.code,{children:"NEO4J_CONTAINER_DATA_VOLUME"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"export NEO4J_CONTAINER_DATA_VOLUME=<path-to-source-path-in-docker>\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Also we need to figure out the path where this volume is mounted in the container.\nThat is defined in the ",(0,a.jsx)(n.code,{children:"Dockerfile"})," as ",(0,a.jsx)(n.code,{children:"NEO4J_dbms_directories_data"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"export NEO4J_DBMS_DIRECTORIES_DATA=<path-configured-in-docker>\n"})}),"\n",(0,a.jsx)(n.p,{children:"So you can actually see if the data has been written to this volume via a docker container since this file system is not accessible outside a docker environment and you may have to mount it manually to an image and check."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it \\\n  --volume ${NEO4J_CONTAINER_DATA_VOLUME}:/${NEO4J_DBMS_DIRECTORIES_DATA} \\\n  alpine:latest \\\n  sh\n"})}),"\n",(0,a.jsx)(n.p,{children:"Within this you can check for the data"}),"\n",(0,a.jsx)(n.h3,{id:"3-create-a-local-dump-folder",children:"3. Create a Local Dump Folder"}),"\n",(0,a.jsx)(n.p,{children:"Create a folder on your local machine to store the dump file."}),"\n",(0,a.jsx)(n.h3,{id:"4-create-a-database-dump",children:"4. Create a Database Dump"}),"\n",(0,a.jsx)(n.p,{children:"Run the following command to create a dump from your Neo4j Docker container:"}),"\n",(0,a.jsxs)(n.p,{children:["What happen below is we are going to run a temporary container (that's why there is ",(0,a.jsx)(n.code,{children:"rm"}),")\nand mount the volume which has neo4j data which is ",(0,a.jsx)(n.code,{children:"NEO4J_CONTAINER_DATA_VOLUME"})," volume and it\nis mounted to the ",(0,a.jsx)(n.code,{children:"/data"})," folder of this temporary container."]}),"\n",(0,a.jsxs)(n.p,{children:["And the following command will create a dump on the ",(0,a.jsx)(n.code,{children:"/backups"})," folder."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"neo4j-admin database dump neo4j --to-path=/backups\n"})}),"\n",(0,a.jsxs)(n.p,{children:["And since we ",(0,a.jsx)(n.code,{children:"--volume=/Users/your_username/Documents/neo4j_dump:/backups "})," since that the\nhost system can also access the backup file."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker run --rm \\\n--volume=${NEO4J_CONTAINER_DATA_VOLUME}:/data \\\n--volume=${NEO4J_BACKUP_DIR}:/backups \\\nneo4j/neo4j-admin:latest \\\nneo4j-admin database dump neo4j --to-path=/backups\n"})}),"\n",(0,a.jsx)(n.h3,{id:"4-verify-the-database-dump-was-created",children:"4. Verify the Database Dump was created"}),"\n",(0,a.jsx)(n.p,{children:"Navigate to the local folder specified previously and check that a dump file has been created inside."}),"\n",(0,a.jsx)(n.h3,{id:"5-upload-the-dump-to-the-neo4j-docker-local",children:"5. Upload the Dump to the Neo4j Docker (Local)"}),"\n",(0,a.jsx)(n.p,{children:"Stop the container"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker compose down neo4j\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker run --interactive --tty --rm \\\n    --volume=${NEO4J_CONTAINER_DATA_VOLUME}:/data \\\n    --volume=${NEO4J_BACKUP_DIR}:/backups \\\n    neo4j/neo4j-admin \\\nneo4j-admin database load neo4j --from-path=/backups --overwrite-destination=true\n"})}),"\n",(0,a.jsx)(n.h3,{id:"6-upload-the-dump-to-neo4j-aura",children:"6. Upload the Dump to Neo4j Aura"}),"\n",(0,a.jsx)(n.p,{children:"Run the following command to upload the dump to your Neo4j Aura instance:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker run --rm \\\n--volume=/Users/your_username/Documents/neo4j_dump:/dump \\\nneo4j/neo4j-admin:latest \\\nneo4j-admin database upload neo4j \\\n--from-path=/dump \\\n--to-uri=<neo4j_uri> \\\n--to-user=<neo4j_user> \\\n--to-password=<neo4j_password> \\\n--overwrite-destination=true\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Important:"})," Replace the following placeholders with your actual values:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"/Users/your_username/Documents/neo4j_dump"})," with the correct path to your local folder with the dump file."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"<neo4j_uri>"}),",",(0,a.jsx)(n.code,{children:"<neo4j_user>"}),",",(0,a.jsx)(n.code,{children:"<neo4j_password>"})," with your actual aura db credentials"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"5-verify-the-migration",children:"5. Verify the Migration"}),"\n",(0,a.jsx)(n.p,{children:"Connect to your Neo4j Aura instance and verify that the new data has been inserted."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453(e,n,o){o.d(n,{R:()=>i,x:()=>s});var t=o(6540);const a={},r=t.createContext(a);function i(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);